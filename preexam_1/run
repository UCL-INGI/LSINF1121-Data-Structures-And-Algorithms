#!/bin/bash

name="BreadthFirstShortestPaths"

parsetemplate --output "student/${name}.java" "student/${name}.java"

cd student/

# We compile the students code
output=$(javac "${name}.java" 2>&1)
retval=$?
if [ "$retval" != "0" ]; then
    output=$(echo "$output" | sed -e 's/^/\t/' | sed -e 's/%/%%%/g')
    feedback-result failed
    feedback-msg -ae -m "Compilation of ${name} failed:\n::\n\n"
    feedback-msg -ae -m "$output"
    exit 1
fi

# We compile the JUnit tests
output=$(javac -cp .:junit-4.12.jar BFSTests.java 2>&1)
retval=$?
if [ "$retval" != "0" ]; then
    output=$(echo "$output" | sed -e 's/^/\t/' | sed -e 's/%/%%%/g')
    feedback-result failed
    feedback-msg -ae -m "Compilation of ${name} failed:\n::\n\n"
    feedback-msg -ae -m "$output"
    exit 1
fi

output=$(run_student java BFSTests)
retval=$?
if [ "$retval" = "0" ]; then
    feedback-result success
    feedback-msg -ae -m "Your implementation passed the tests !"
else
    feedback-result failed
    feedback-msg -ae -m "Your implementation didn't pass the tests !"
fi
