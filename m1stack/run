#! /bin/bash
# TODO compilation errors ? and cheat != 0
getinput stack > MyStack.java

cheat=$(cat MyStack.java | grep -c "import java.util.Stack")
if [ $cheat != "1" ]; then
	feedback --result failed --feedback "You can't use java.util.Stack!"
else

	javac MyStack.java
    if [ ! -f MyStack.class ]; then
    	feedback --result failed --feedback "Compilation failed"
    else
    
    	scalac -cp .:scalacheck.jar StackProps.scala
		output=$(run_student scala -cp .:scalacheck.jar StackProps)
		if [ "$output" = "252"]; then
        	feedback --result failed --feedback "Command was killed due to an out-of-memory"
        elif [ "$output" = "253"]; then
        	feedback --result failed --feedback "Command timed out"
        elif [ "$output" = "254"]; then
        	feedback --result failed --feedback "An runtime error occured"
        else
    
			failed=$(echo "$output" | grep -c "Falsified")
			passed=$(echo "$output" | grep -c "OK")

			if [ "$failed" = "0" ]; then
				feedback --result success --feedback "Congratulations, you passed all the tests!"
			else
				feedback --result failed --feedback "Unfortunately, you failed $failed tests out of $(($passed+$failed))"
			fi
    	fi
	fi
fi
